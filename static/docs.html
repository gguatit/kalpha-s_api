<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Dead Drop API Docs</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <div class="wrap">
    <header class="header">
      <div class="logo"><span class="mark"></span><div><h1>Dead Drop</h1><div class="subtitle">한 번만 읽을 수 있는 일회성 비밀 메시지 저장소</div></div></div>
      <div class="meta"><span class="badge">TTL 1시간</span></div>
    </header>

    <div class="layout">
      <aside class="panel">
        <nav>
          <ul>
            <li><a href="#endpoints">Endpoints</a></li>
            <li><a href="#examples">Examples</a></li>
            <li><a href="#responses">Responses</a></li>
            <li><a href="#ops">Operational</a></li>
          </ul>
        </nav>
      </aside>

      <main>
        <section class="panel" id="endpoints">
          <h2>Endpoints</h2>
          <p class="muted">간단히: POST <code>/store</code> → 저장(1시간), GET <code>/read/:id</code> → 한 번만 읽기</p>
          <h3>POST /store</h3>
          <p>요청: <code>Content-Type: application/json</code>, body: <code>{"message":"..."}</code></p>
          <pre id="post-example">curl -i -X POST https://api.kalpha.kr/store \
  -H "Content-Type: application/json" \
  -d '{"message":"내 비밀번호는 1234"}'</pre>
          <button class="copy" onclick="navigator.clipboard.writeText(document.getElementById('post-example').innerText)">복사</button>

          <h3>GET /read/:id</h3>
          <p>발급된 ID로 한 번만 조회, 조회 즉시 삭제</p>
          <pre id="get-example">curl -i https://api.kalpha.kr/read/&lt;UUID&gt;</pre>
          <button class="copy" onclick="navigator.clipboard.writeText(document.getElementById('get-example').innerText)">복사</button>
        </section>

        <section class="panel" id="examples">
          <h2>Examples</h2>
          <pre id="js-example">const res = await fetch('https://api.kalpha.kr/store', {method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({message:'비밀'})});const j=await res.json();console.log(j);</pre>
          <button class="copy" onclick="navigator.clipboard.writeText(document.getElementById('js-example').innerText)">복사</button>
          <h4>Local</h4>
          <pre id="local-example">curl -i -X POST http://127.0.0.1:8787/store -H "Content-Type: application/json" -d '{"message":"test"}'</pre>
          <button class="copy" onclick="navigator.clipboard.writeText(document.getElementById('local-example').innerText)">복사</button>
        </section>

        <section class="panel" id="responses">
          <h2>Responses</h2>
          <p class="muted">응답은 간단하고 예측 가능합니다. 아래 예시에서는 본문(JSON)과 관련 응답 헤더를 함께 보여줍니다.</p>
          <h4>POST /store (성공)</h4>
          <pre>// HTTP 201
      {"id":"..."}

      # 응답 헤더 예시
      Location: https://api.kalpha.kr/read/&lt;id&gt;
      X-DeadDrop-Id: &lt;id&gt;</pre>

          <h4>GET /read/:id (성공)</h4>
          <pre>// HTTP 200
      {"message":"..."}</pre>

          <h4>오류</h4>
          <pre>// 400 잘못된 요청
      {"error":"missing message"}

      // 404 찾을 수 없거나 이미 읽힘
      {"error":"not found or already read"}

      // 401 인증 실패 (env.API_KEY 설정 시)
      {"error":"unauthorized"}

      // 413 메시지 길이 초과
      {"error":"message too long"}</pre>
        </section>

        <section class="panel" id="ops">
          <h2>Operational notes</h2>
          <ul>
            <li>운영환경에서는 인증(Bearer token 등)을 권장합니다.</li>
            <li>원자성이 필요하면 Durable Object 고려.</li>
            <li>레이트리밋/길이 제한 적용 권장.</li>
          </ul>
        </section>
      </main>
    </div>

    <footer>문의/개선 요청: repository 관리자에게 연락하세요.</footer>
  </div>
</body>
</html>
